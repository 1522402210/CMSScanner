module CMSScanner
  # References related to the vulnerability
  class Vulnerability
    # @return [ Array<String> ] The CVEs
    def cves
      @cve ||= [*references[:cve]]
    end

    # @return [ Array<String> ]
    def cve_urls
      cves.reduce([]) { |a, e| a << cve_url(e) }
    end

    # @return [ String ] The URL to the CVE
    def cve_url(cve)
      "http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-#{cve}"
    end

    # @return [ Array<String>  ] The Secunia IDs
    def secunia_ids
      @secunia_ids ||= [*references[:secunia]]
    end

    # @return [ Array<String> ]
    def secunia_urls
      secunia_ids.reduce([]) { |a, e| a << secunia_url(e) }
    end

    # @return [ String ] The URL to the Secunia advisory
    def secunia_url(id)
      "https://secunia.com/advisories/#{id}"
    end

    # @return [ Array<String>  ] The OSVDB IDs
    def osvdb_ids
      @osvdb_ids ||= [*references[:osvdb]]
    end

    # @return [ Array<String> ]
    def osvdb_urls
      osvdb_ids.reduce([]) { |a, e| a << osvdb_url(e) }
    end

    # @return [ String ] The URL to the ExploitDB advisory
    def osvdb_url(id)
      "http://osvdb.org/#{id}"
    end

    # @return [ Array<String>  ] The ExploitDB ID
    def exploitdb_ids
      @exploitdb_ids ||= [*references[:exploitdb]]
    end

    # @return [ Array<String> ]
    def exploitdb_urls
      exploitdb_ids.reduce([]) { |a, e| a << exploitdb_url(e) }
    end

    # @return [ String ]
    def exploitdb_url(id)
      "http://www.exploit-db.com/exploits/#{id}/"
    end

    # @return [ String<Array> ]
    def urls
      @urls ||= [*references[:urls]]
    end

    # @return [ Array<String> ] The metasploit modules
    def msf_modules
      @msf_modules ||= [*references[:msf]]
    end

    # @return [ Array<String> ]
    def msf_urls
      msf_modules.reduce([]) { |a, e| a << msf_url(e) }
    end

    # @return [ String ] The URL to the metasploit module page
    def msf_url(mod)
      "http://www.rapid7.com/db/modules/#{mod.sub(/^\//, '')}"
    end
  end
end
